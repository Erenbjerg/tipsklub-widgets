<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gruppe-tr√¶kning</title>

  <style>
    *{box-sizing:border-box}

    html,body{
      margin:0;padding:0;
      background:#0b0f14;
      font-family:Inter,Arial,sans-serif;
      color:#e5e7eb;
    }

    .wrap{padding:14px}

    .card{
      background:radial-gradient(1200px 600px at top, #111827, #020617);
      border:1px solid #1f2933;
      border-radius:18px;
      padding:14px;
      box-shadow:0 20px 50px rgba(0,0,0,.6);
    }

    /* Header */
    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }

    h3{
      margin:0;
      font-size:14px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#fbbf24;
    }

    .status{
      font-size:12px;
      color:#9ca3af;
    }

    /* Buttons */
    .btns{display:flex;gap:8px}

    button{
      background:linear-gradient(180deg,#16a34a,#065f46);
      border:0;
      color:#ecfeff;
      font-weight:900;
      font-size:12px;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      box-shadow:0 4px 16px rgba(22,163,74,.4);
    }

    button.secondary{
      background:#020617;
      color:#9ca3af;
      border:1px solid #1f2937;
      box-shadow:none;
    }

    button:hover{transform:translateY(-1px)}

    /* Groups grid */
    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
    }

    @media(max-width:800px){
      .grid{grid-template-columns:1fr}
    }

    .group{
      background:linear-gradient(180deg,#020617,#020617);
      border:1px solid #1f2937;
      border-radius:16px;
      padding:12px;
      position:relative;
      overflow:hidden;
    }

    .group:before{
      content:'';
      position:absolute;
      inset:0;
      background:
        radial-gradient(300px 100px at top,#16a34a22,transparent),
        linear-gradient(90deg,transparent,#16a34a11,transparent);
      pointer-events:none;
    }

    .gtitle{
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      margin-bottom:10px;
      color:#22c55e;
    }

    .name{
      background:#020617;
      border:1px solid #1f2937;
      border-radius:12px;
      padding:8px 10px;
      margin-bottom:8px;
      font-weight:800;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .chip{
      width:22px;height:22px;
      border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%,#fef3c7,#f59e0b);
      color:#111827;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      font-weight:900;
    }

    .meta{
      display:flex;
      justify-content:space-between;
      margin-top:10px;
      font-size:11px;
      color:#9ca3af;
    }

    /* Shuffle animation */
    .spin{
      animation:spin .6s ease;
    }
    @keyframes spin{
      0%{transform:rotateX(0)}
      50%{transform:rotateX(90deg)}
      100%{transform:rotateX(0)}
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <div class="top">
      <div>
        <h3>Gruppetr√¶kning</h3>
        <div class="status" id="status">Indl√¶ser odds‚Ä¶</div>
      </div>
      <div class="btns">
        <button id="regen">üé≤ Tr√¶k nye</button>
        <button class="secondary" id="reset">Reset</button>
      </div>
    </div>

    <div class="grid spin" id="grid"></div>

    <div class="meta">
      <div id="stamp"></div>
      <div id="count"></div>
    </div>

  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwEZfTv0Bq52l-Nm_NiOpJFf_tWukgrqAM2NgCQjitZf2EuZb3XO2bNGyO1ZR82gbjH/exec";
const STORAGE = "tipsklub_groups_v2";

const esc = s => (s??"").toString().replace(/</g,'&lt;').replace(/>/g,'&gt;');

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function render(groups){
  const grid=document.getElementById("grid");
  grid.classList.remove("spin");
  void grid.offsetWidth;
  grid.classList.add("spin");

  grid.innerHTML = groups.map((g,i)=>`
    <div class="group">
      <div class="gtitle">Bord ${i+1}</div>
      ${g.map((n,idx)=>`
        <div class="name">
          <div class="chip">${idx+1}</div>
          ${esc(n)}
        </div>
      `).join("")}
    </div>
  `).join("");

  document.getElementById("count").innerText="Spillere: "+groups.flat().length;
}

function save(groups){
  localStorage.setItem(STORAGE,JSON.stringify({
    t:Date.now(),groups
  }));
  document.getElementById("stamp").innerText =
    "Trukket: "+new Date().toLocaleString("da-DK");
}

function loadSaved(){
  try{
    const d=JSON.parse(localStorage.getItem(STORAGE));
    if(!d) return null;
    document.getElementById("stamp").innerText =
      "Trukket: "+new Date(d.t).toLocaleString("da-DK");
    return d.groups;
  }catch(e){return null;}
}

async function make(){
  document.getElementById("status").innerText="Ruller terninger‚Ä¶";
  const r=await fetch(API_URL,{cache:"no-store"});
  const d=await r.json();
  const names=(d.stats||[]).map(x=>x.name).filter(Boolean);

  const groups = shuffle(names.slice()).reduce((acc,n,i)=>{
    (acc[Math.floor(i/4)] ||= []).push(n);
    return acc;
  },[]).slice(0,3);

  render(groups);
  save(groups);
  document.getElementById("status").innerText="Spil √•ben üé∞";
}

(async()=>{
  const saved=loadSaved();
  if(saved){render(saved);return;}
  await make();
})();

document.getElementById("regen").onclick=make;
document.getElementById("reset").onclick=()=>{
  localStorage.removeItem(STORAGE);
  location.reload();
};
</script>

</body>
</html>
